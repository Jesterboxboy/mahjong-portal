{% extends 'base.html' %}
{% load i18n humanize russian_words_morph meta_tags_helper tz %}

{% block title %}
    {{ club.name }}
{% endblock %}

{% block content %}
    <div>
        <h1>{{ club.name }}</h1>
        {% if club.website %}
            <p><a href="{{ club.website }}" target="_blank">{{ club.website }}</a></p>
        {% endif %}

        <p>
            {% if club.city %}
                <a href="{% url 'city_page' club.city.slug %}">{{ club.city.name }}</a>,
            {% endif %}
            {{ club.country }}
        </p>

        {% if club.description %}
            <p>{{ club.description|linebreaksbr }}</p>
        {% endif %}

        {% if tournaments %}
            <h2>{% trans 'Tournaments' %}</h2>
            {% include 'tournament/_tournaments_table.html' %}
        {% endif %}

        {% if club_rating %}
            <h2 id="stat">{% trans 'Club members statistics' %}</h2>
            <p>{% trans 'We are displaying here players with 5+ club games.' %}</p>
            <p> {% trans 'Sorting:' %}
                <select name="" id="" class="form-control d-inline" style="width: 150px; ">
                    {% for key, value in sorting.items %}
                        <option value="{{ key }}">{{ value }}</option>
                    {% endfor %}
                </select>
            </p>
            <div class="table-responsive">
                <table class="table mt-2 table-bordered table-striped">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">{% trans 'Name' %}</th>
                            <th scope="col">
                                {% trans 'Tenhou' %}
                            </th>
                            <th scope="col">
                                <nobr>{% trans 'Avg. place' %}</nobr>
                            </th>
                            <th scope="col">
                                {% trans 'Games' %}
                            </th>
                            <th scope="col">
                                {% trans '1st' %}
                            </th>
                            <th scope="col">
                                {% trans '2nd' %}
                            </th>
                            <th scope="col">
                                {% trans '3rd' %}
                            </th>
                            <th scope="col">
                                {% trans '4th' %}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in club_rating %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    {% if item.player %}
                                        <a href="{% url 'player_details' item.player.slug %}">
                                            <nobr>{{ item.player }}</nobr>
                                        </a>
                                    {% else %}
                                        <nobr>{{ item.player_string }}</nobr>
                                    {% endif %}
                                </td>
                                <td>
                                    {% with tenhou_object=item.player.tenhou_object %}
                                        {% if tenhou_object %}
                                            <a class="not-colored-link" href="http://arcturus.su/tenhou/ranking/ranking.pl?name={{ tenhou_object.tenhou_username }}&d1={{ tenhou_object.username_created_at|date:'Ymd' }}" target="_blank">
                                                {{ tenhou_object.get_rank_display }}
                                            </a>
                                        {% endif %}
                                    {% endwith %}
                                </td>
                                <td>
                                    {{ item.average_place|floatformat:2 }}
                                </td>
                                <td>
                                    {{ item.games_count }}
                                </td>
                                <td>
                                    {{ item.first_place|floatformat:2 }}
                                </td>
                                <td>
                                    {{ item.second_place|floatformat:2 }}
                                </td>
                                <td>
                                    {{ item.third_place|floatformat:2 }}
                                </td>
                                <td>
                                    {{ item.fourth_place|floatformat:2 }}
                                </td>
                            </tr>
                            <tr>
                                <td></td>
                                <td colspan="8">
                                    <span title="{% trans 'How often player feed to other hand' %}" data-toggle="tooltip" data-placement="bottom" class="tooltip-link">
                                        <nobr>{% trans 'feeds' %}</nobr>
                                    </span>
                                    {{ item.feed_percentage|floatformat:2 }}%,

                                    <span title="{% trans 'How often riichi was ended with ippatsu' %}" data-toggle="tooltip" data-placement="bottom" class="tooltip-link">
                                        <nobr>{% trans 'ippatsu' %}</nobr>
                                    </span>
                                    {{ item.ippatsu_chance|floatformat:2 }}%,

                                    <span title="{% trans 'How many win hands were opened' %}" data-toggle="tooltip" data-placement="bottom" class="tooltip-link">
                                        <nobr>{% trans 'open hands' %}</nobr>
                                    </span>
                                    {{ item.open_hand|floatformat:2 }}%,

                                    <span title="{% trans 'How often riichi was ended with win' %}" data-toggle="tooltip" data-placement="bottom" class="tooltip-link">
                                        <nobr>{% trans 'successful riichi' %}</nobr>
                                    </span>
                                    {{ item.successful_riichi|floatformat:2 }}%,

                                    <span title="{% trans 'Average dora number in win hands' %}" data-toggle="tooltip" data-placement="bottom" class="tooltip-link">
                                        <nobr>{% trans 'avg. dora' %}</nobr>
                                    </span>
                                    {{ item.average_dora_in_hand|floatformat:2 }}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}

        {% if club_sessions %}
            <h2>{% trans 'Latest 10 club games' %}</h2>
            {% timezone club.timezone %}
                <p>
                    {% trans 'Total games: ' %} {{ total_sessions }}.
                    {% trans 'Last updated ' %} {{ club.sync_info.updated_on }}
                </p>
            {% endtimezone %}

            <div class="table-responsive-sm">
                <table class="table mt-4 table-bordered table-striped">
                    <tbody>
                        {% for club_session in club_sessions %}
                            <tr class="">
                                <td colspan="8">
                                    {% timezone club.timezone %}
                                        {% if club_session.pantheon_id %}
                                            <a href="https://gui.mjtop.net/eid61/game/{{ club_session.pantheon_id }}" target="_blank">
                                                {{ club_session.date }}
                                            </a>
                                        {% else %}
                                            {{ club_session.date }}
                                        {% endif %}
                                    {% endtimezone %}
                                </td>
                            </tr>
                            <tr>
                                {% for result in club_session.results.all %}
                                    <td>
                                        <nobr>
                                            {{ result.wind }}
                                            {% if result.player %}
                                                <a href="{% url 'player_details' result.player.slug %}">{{ result.player }}</a>
                                            {% else %}
                                                {{ result.player_string }}
                                            {% endif %}
                                        </nobr>
                                    </td>
                                    <td>{{ result.score|intcomma }}</td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block meta_tags %}
    <meta name="description" content="{% club_page_description club %}">
    <meta property="og:description" content="{% club_page_description club %}" />
{% endblock %}